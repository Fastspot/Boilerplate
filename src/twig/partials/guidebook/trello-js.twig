<script>
	var trelloTriggers;
	var trelloHash;

	trelloInit();

	function trelloInit() {
		bindTrelloVars();
		bindTrelloUI();
		queryTrelloHash();
		checkEmptySections();
	}

	function bindTrelloVars() {
		trelloTriggers = document.querySelectorAll(".gb_trello_detail_close");
	}

	function bindTrelloUI() {
		window.addEventListener("hashchange", queryTrelloHash, false);

		for(var i = 0; i < trelloTriggers.length; i++) {
			trelloTriggers[i].addEventListener("click", removeTrelloHash, false);
		}
	}

	function queryTrelloHash() {
		if(window.location.hash) {
			trelloHash = window.location.hash;
			if(trelloHash.indexOf("trelloList") !== 1) {
				openTrelloDetail();
				openTrelloDetailHash(trelloHash);
			}
		} else if(trelloHash !== undefined) {
			closeTrelloDetail();
			closeTrelloDetailHash(trelloHash);
		}
	}

	function openTrelloDetail() {
		document.body.classList.add('fs-navigation-lock');
	}

	function openTrelloDetailHash(hash) {
		document.querySelector(hash).classList.add('fs-swap-active');
	}

	function closeTrelloDetail() {
		document.body.classList.remove('fs-navigation-lock');
	}

	function closeTrelloDetailHash(hash) {
		document.querySelector(hash).classList.remove('fs-swap-active');
	}

	function removeTrelloHash() {
		window.location.href = window.location.href.split('#')[0];
	}

	function checkEmptySections() {
		var topicGroups = document.querySelectorAll('.gb_topics');

		for(var i = 0; i < topicGroups.length; i++) {
			if(topicGroups[i].firstElementChild === null) {
				topicGroups[i].parentElement.parentElement.classList.add('empty');
				topicGroups[i].parentElement.parentElement.innerHTML = "";
			}
		}
	}
</script>
